### 死锁

> 独占性资源：例如打印机、磁带、系统内部表项等

#### 处理死锁的策略

- 忽略该问题
- 检测死锁并修复
- 仔细对资源进行分配，动态避免死锁
- 破坏引起死锁的四个必要条件之一

#### 对应的算法

【1】鸵鸟算法（不管死锁）

【2】死锁检测和恢复（死锁可能已经发生，进行检测和恢复）

> 允许死锁发生，检测到死锁后进行恢复

- 死锁检测

  - 每种类型一个资源

    构建资源分配图，检测其中是否存在环路

    ![image-20210827214107932](https://i.loli.net/2021/08/27/EU4ClpNisgQKymh.png)

    **算法思想：**将每一个节点作为树的根节点，进行DFS遍历，如果遇到已经遍历过的节点，**则树中存在环**，遍历完所有节点之后依然没有环则表示不存在死锁。

  - 每种类型多个资源

    ![image-20210827215607019](https://i.loli.net/2021/08/27/NqkEwDGitoUpv6V.png)

    1. 构建现有资源向量，表示每种资源的数量；
    2. 构建可用资源向量，表示每种资源的可用数量；
    3. 构建当前分配矩阵，每行代表一个进程；
    4. 构建请求矩阵，每行表示每个进程请求的各类资源。

    检测算法如下：

![image-20210827215634643](https://i.loli.net/2021/08/27/XSCETKRJV5ztFOj.png)

​					**前提是要知道资源预先分配的数量**。

- 从死锁中恢复

  - 利用抢占恢复

  - 利用回滚恢复

    周期性地存储进程（该进程拥有死锁进程的资源）运行的checkpoint，需要时进行回滚

  - 杀死进程

【3】死锁避免

【4】死锁预防（破坏死锁四个条件之一）

- 互斥

  假脱机技术

- 占有并等待

  请求的资源都满足时才运行

- 不可抢占

  通过虚拟化的方式实现抢占

- 环路等待

  将资源编号进行顺序请求

